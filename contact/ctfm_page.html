<mvt:assign name="g.http_referer" value="s.http_referer" />
<mvt:if expr="'CTFM' CIN g.http_referer OR 'contact-form' CIN g.http_referer">
	<mvt:exit>
</mvt:if>

<mvt:if expr="NOT ISNULL g.website">
	<meta http-equiv="refresh" content="0;url=&mvte:urls:NTFD:auto;" />
<mvt:else>
	<mvt:if expr="(ISNULL g.website) AND (NOT ISNULL g.human) AND (isdigit(g.human)) AND (g.human EQ crypto_base64_decode(g.verify))">
		<mvt:assign name="l.mail:from" value="g.contactName $ ' <' $ g.contactEmail $ '>'" />
		<mvt:if expr="NOT ISNULL g.storeEmail">
			<mvt:assign name="l.mail:to" value="crypto_base64_decode(g.storeEmail)" />
		<mvt:else>
			<mvt:assign name="l.mail:to" value="g.store:email" />
		</mvt:if>

		<mvt:comment>
			<!--
			If you would like to CC the form, you can add an address or a comma separated list to CC to
			multiple addresses.
			<mvt:assign name="l.mail:cc" value="'my_email@my_domain.com'" />
			- OR -
			<mvt:assign name="l.mail:cc" value="'my_email@my_domain.com,my_other_email@my_domain.com'" />
			-->
		</mvt:comment>

		<mvt:comment>
			<!--
			If you would like to BCC the form, you can add an address or a comma separated list to BCC to
			multiple addresses.
			<mvt:assign name="l.mail:bcc" value="'my_email@my_domain.com'" />
			- OR -
			<mvt:assign name="l.mail:bcc" value="'my_email@my_domain.com,my_other_email@my_domain.com'" />
			-->
		</mvt:comment>
		
		<mvt:assign name="l.mail:subject" value="'[' $ g.store:name $ ' Contact Form] ' $ g.contactSubject" />
		<mvt:assign name="l.mail:message" value="'Message from: ' $ g.contactName $ asciichar(13) $ asciichar(10) $ asciichar(13) $ asciichar(10) $ g.contactMessage" />
		<mvt:do file="g.Module_Library_Utilities" name="g.sent" value="v9_SendEmail(l.mail)" />
		<mvt:if expr="g.sent">
			<meta http-equiv="refresh" content="0;url=&mvte:urls:CTUS:auto_sep;status=submitted" />
		<mvt:else>
			<meta http-equiv="refresh" content="0;url=&mvte:urls:CTUS:auto_sep;status=error" />
		</mvt:if>
	<mvt:else>
		<meta http-equiv="refresh" content="0;url=&mvte:urls:CTUS:auto_sep;status=error&amp;contactName=&mvte:global:contactName;&amp;contactEmail=&mvte:global:contactEmail;&amp;contactSubject=&mvte:global:contactSubject;&amp;contactMessage=&mvte:global:contactMessage;&amp;fault=has-error" />
	</mvt:if>
</mvt:if>
